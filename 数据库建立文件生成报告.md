# 数据库建立文件生成报告

## 🎯 任务概述
根据当前项目中的实体类和现存的数据表，生成了完整的数据库建立文件，用于解决Spring Boot应用启动时的数据库模式验证问题。

## 📊 当前数据库状态分析

### 现存数据表（13个）
1. `daily_country_risk_stats` - 每日国家风险统计表
2. `t_country` - 国家基础信息表
3. `t_crawler_checkpoint` - 爬虫断点续传表
4. `t_crawler_data` - 爬虫数据表
5. `t_crawler_state` - 爬虫状态表
6. `t_customs_case` - 海关过往判例表
7. `t_device_510k` - 设备510K记录表
8. `t_device_event` - 设备事件报告表
9. `t_device_recall` - 设备召回记录表
10. `t_device_registration` - 设备注册记录表
11. `t_devicematch_keywords` - 设备匹配关键词表
12. `t_guidance_document` - 医疗文档表
13. `t_keyword` - 关键词表

### 对应实体类（13个）
1. `CertNewsDailyCountryRiskStats.java`
2. `Country.java`
3. `CrawlerCheckpoint.java`
4. `CertNewsData.java`
5. `CrawlerState.java`
6. `CustomsCase.java`
7. `Device510K.java`
8. `DeviceEventReport.java`
9. `DeviceRecallRecord.java`
10. `DeviceRegistrationRecord.java`
11. `DeviceMatchKeywords.java`
12. `GuidanceDocument.java`
13. `Keyword.java`

## 📄 生成的文件

### 1. create_database_schema.sql
**完整版数据库建立脚本**
- ✅ 包含所有13个表的完整结构定义
- ✅ 包含详细的字段注释和索引
- ✅ 包含基础数据插入
- ✅ 包含视图、存储过程和触发器
- ✅ 包含完整的约束和关系定义

**特点：**
- 生产环境适用
- 包含完整的数据库功能
- 支持高级特性（视图、存储过程、触发器）
- 详细的注释和文档

### 2. rebuild_database.sql
**快速重建脚本**
- ✅ 简化的表结构定义
- ✅ 核心字段和索引
- ✅ 基础数据插入
- ✅ 快速执行

**特点：**
- 开发环境适用
- 快速重建数据库
- 简化的结构，易于理解和修改
- 适合解决启动问题

## 🗂️ 表结构详情

### 核心业务表
| 表名 | 实体类 | 主要功能 | 关键字段 |
|------|--------|----------|----------|
| `t_device_510k` | Device510K | FDA 510K设备记录 | k_number, device_class, risk_level |
| `t_device_event` | DeviceEventReport | 设备事件报告 | report_number, risk_level, device_class |
| `t_device_recall` | DeviceRecallRecord | 设备召回记录 | cfres_id, recall_status, risk_level |
| `t_device_registration` | DeviceRegistrationRecord | 设备注册记录 | registration_number, data_source |
| `t_guidance_document` | GuidanceDocument | 医疗指导文档 | title, document_type, risk_level |
| `t_customs_case` | CustomsCase | 海关判例 | case_number, violation_type, risk_level |

### 系统管理表
| 表名 | 实体类 | 主要功能 | 关键字段 |
|------|--------|----------|----------|
| `t_country` | Country | 国家基础信息 | country_code, country_name |
| `t_keyword` | Keyword | 关键词管理 | keyword, enabled |
| `t_devicematch_keywords` | DeviceMatchKeywords | 设备匹配关键词 | keyword, keyword_type |
| `t_crawler_data` | CertNewsData | 爬虫数据存储 | id, source_name, risk_level |
| `t_crawler_state` | CrawlerState | 爬虫状态管理 | crawler_name, status |
| `t_crawler_checkpoint` | CrawlerCheckpoint | 爬虫断点续传 | crawler_type, status |
| `daily_country_risk_stats` | CertNewsDailyCountryRiskStats | 风险统计 | stat_date, country |

## 🔧 关键特性

### 1. 风险等级管理
- 统一的`risk_level`枚举：`HIGH`, `MEDIUM`, `LOW`, `NONE`
- 所有业务表都包含风险等级字段
- 支持风险统计和分析

### 2. 数据源管理
- 支持多数据源：`US_FDA`, `EU_EUDAMED`, `FDA`, `EU`等
- 国家标识：`jd_country`字段标识数据适用国家
- 数据源追踪：`data_source`字段记录数据来源

### 3. 关键词系统
- 基础关键词表：`t_keyword`
- 设备匹配关键词表：`t_devicematch_keywords`
- 支持关键词类型：`NORMAL`, `BLACKLIST`
- JSON格式存储关键词数组

### 4. 爬虫管理
- 爬虫状态管理：`t_crawler_state`
- 断点续传支持：`t_crawler_checkpoint`
- 数据存储：`t_crawler_data`
- 支持多种爬虫类型和状态

### 5. 时间管理
- 统一的时间字段：`create_time`, `update_time`, `crawl_time`
- 支持日期范围查询
- 自动时间戳更新

## 🚀 使用说明

### 快速解决启动问题
```bash
# 1. 执行快速重建脚本
mysql -u root -p2020 -h localhost < rebuild_database.sql

# 2. 启动Spring Boot应用
cd spring-boot-backend
mvn spring-boot:run
```

### 生产环境部署
```bash
# 1. 执行完整建立脚本
mysql -u root -p2020 -h localhost < create_database_schema.sql

# 2. 验证数据库结构
mysql -u root -p2020 -h localhost common_db -e "SHOW TABLES;"

# 3. 启动应用
mvn spring-boot:run
```

## ⚠️ 注意事项

### 1. 数据备份
- 执行重建脚本前请备份现有数据
- 生产环境请谨慎操作

### 2. 配置调整
- 确保`application.yml`中的数据库配置正确
- 建议将Hibernate模式设置为`update`或`none`

### 3. 索引优化
- 已为常用查询字段创建索引
- 可根据实际使用情况调整索引策略

### 4. 字符集设置
- 使用`utf8mb4`字符集支持完整的Unicode
- 确保中文字符正确存储和显示

## 📈 性能优化建议

### 1. 索引优化
- 为经常查询的字段添加索引
- 考虑复合索引优化多字段查询
- 定期分析查询性能并调整索引

### 2. 分区策略
- 对于大数据量表考虑按时间分区
- 爬虫数据表可按日期分区

### 3. 缓存策略
- 国家信息等基础数据可缓存
- 关键词数据可缓存提高查询性能

## 🎯 下一步行动

1. **立即执行**：使用`rebuild_database.sql`快速解决启动问题
2. **验证功能**：启动应用并验证所有功能正常
3. **数据迁移**：如有需要，从备份中恢复重要数据
4. **性能测试**：进行数据库性能测试和优化
5. **监控设置**：设置数据库监控和告警

---

**报告生成时间**: 2025-09-28 14:20  
**文件状态**: ✅ 已完成  
**数据库状态**: 🔄 待重建  
**应用状态**: 🔄 待启动
